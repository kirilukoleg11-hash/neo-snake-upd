<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neo Snake Online</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body {
            display: flex; justify-content: center; align-items: center;
            height: 100vh; margin: 0; background-color: #05050a;
            color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden;
            flex-direction: column; touch-action: none;
        }
        .menu-toggle {
            position: absolute; top: 10px; left: 10px; z-index: 100;
            background: #4834d4; border: none; color: white; padding: 10px 15px; border-radius: 8px; cursor: pointer;
        }
        .sidebar {
            position: absolute; left: -300px; top: 0; width: 250px; height: 100%;
            background: rgba(10, 10, 25, 0.98); padding: 60px 20px;
            border-right: 2px solid #4834d4; transition: 0.3s; z-index: 90; overflow-y: auto;
        }
        .sidebar.open { left: 0; }
        .section-title { color: #00d2ff; font-size: 13px; margin: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; }
        .mode-btn { width: 100%; padding: 10px; margin-bottom: 5px; background: rgba(72, 52, 212, 0.2); border: 1px solid #4834d4; color: white; border-radius: 6px; cursor: pointer; font-size: 13px; transition: 0.2s; }
        .mode-btn.active { background: #00d2ff; color: #05050a; font-weight: bold; border-color: #fff; box-shadow: 0 0 10px #00d2ff; }
        
        canvas { border: 2px solid #4834d4; border-radius: 8px; background-color: #000; max-width: 95vw; max-height: 40vh; box-shadow: 0 0 20px rgba(72, 52, 212, 0.4); }
        .stats { font-size: 24px; font-weight: bold; color: #00d2ff; margin-bottom: 5px; text-shadow: 0 0 10px #00d2ff; }

        #gameOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; justify-content: center;
            align-items: center; z-index: 50; flex-direction: column; text-align: center;
        }
        #countdownText { font-size: 100px; color: #00d2ff; font-weight: bold; display: none; text-shadow: 0 0 30px #00d2ff; }
        #deathText { display: none; }
        #deathText h1 { color: #ff4757; font-size: 40px; margin-bottom: 10px; text-shadow: 0 0 20px #ff4757; }
        
        .controls { display: grid; grid-template-columns: repeat(3, 75px); gap: 10px; margin-top: 15px; }
        .btn { width: 75px; height: 75px; background: rgba(72, 52, 212, 0.3); border: 2px solid #4834d4; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; color: white; user-select: none; }
        .btn:active { background: #00d2ff; transform: scale(0.9); }
    </style>
</head>
<body>

    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞ –ù–ê–°–¢–†–û–ô–ö–ò</button>

    <div class="sidebar" id="sidebar">
        <div class="section-title">–°–∫–∏–Ω—ã</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <button class="mode-btn" id="skin_neon" onclick="setSkin('neon')">–ù–µ–æ–Ω</button>
            <button class="mode-btn" id="skin_gold" onclick="setSkin('gold')">–ó–æ–ª–æ—Ç–æ</button>
            <button class="mode-btn" id="skin_emerald" onclick="setSkin('emerald')">–ò–∑—É–º—Ä—É–¥</button>
            <button class="mode-btn" id="skin_pink" onclick="setSkin('pink')">–§–∞–Ω—Ç–æ–º</button>
        </div>

        <div class="section-title">–°–∫–æ—Ä–æ—Å—Ç—å</div>
        <button class="mode-btn" id="spd_slow" onclick="setSpeed(0.08, 'spd_slow')">–ú–µ–¥–ª–µ–Ω–Ω–æ</button>
        <button class="mode-btn" id="spd_norm" onclick="setSpeed(0.12, 'spd_norm')">–û–±—ã—á–Ω—ã–π</button>
        <button class="mode-btn" id="spd_fast" onclick="setSpeed(0.18, 'spd_fast')">–ë—ã—Å—Ç—Ä–æ üî•</button>

        <div class="section-title">–†–∞–∑–º–µ—Ä –∫–∞—Ä—Ç—ã</div>
        <button class="mode-btn" id="size_15" onclick="setMapSize(15, 'size_15')">15x15</button>
        <button class="mode-btn" id="size_20" onclick="setMapSize(20, 'size_20')">20x20</button>

        <div style="margin-top:20px; background:rgba(255,255,255,0.05); padding:10px; border-radius:8px;">
            <h4 style="text-align:center; color:#3ae374; margin:0 0 10px 0;">–¢–û–ü –ú–ò–†–ê</h4>
            <div id="leaderboard-content" style="font-size: 12px;"></div>
        </div>

        <button class="mode-btn" style="margin-top:25px; opacity:0.6; border-color: #ff4757;" onclick="resetAccount()">–°–ú–ï–ù–ò–¢–¨ –ù–ò–ö</button>
    </div>

    <div id="gameOverlay">
        <div id="startScreen">
            <h1 style="color:#00d2ff; font-size: 45px; margin-bottom: 20px;">SNAKE<br>ONLINE</h1>
            <button class="mode-btn" style="width:220px; font-size:22px; padding:15px" onclick="startCountdown()">–ò–ì–†–ê–¢–¨</button>
        </div>
        <div id="countdownText">3</div>
        <div id="deathText">
            <h1>–¢–´ –ü–û–ì–ò–ë!</h1>
            <p id="finalScore" style="font-size:24px; color:#aaa;"></p>
            <button class="mode-btn" style="width:220px; font-size:22px; padding:15px" onclick="startCountdown()">–†–ï–°–¢–ê–†–¢</button>
        </div>
    </div>

    <div class="stats">SCORE: <span id="score">0</span></div>
    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <div class="btn" style="grid-column:2" onmousedown="handleInput('w')" ontouchstart="handleInput('w')">‚ñ≤</div>
        <div class="btn" style="grid-column:1; grid-row:2" onmousedown="handleInput('a')" ontouchstart="handleInput('a')">‚óÄ</div>
        <div class="btn" style="grid-column:2; grid-row:2" onmousedown="handleInput('s')" ontouchstart="handleInput('s')">‚ñº</div>
        <div class="btn" style="grid-column:3; grid-row:2" onmousedown="handleInput('d')" ontouchstart="handleInput('d')">‚ñ∂</div>
    </div>

    <script>
        // === –í–°–¢–ê–í–¨ –°–í–û–ô FIREBASE CONFIG –¢–£–¢ ===
        const firebaseConfig = {

  apiKey: "AIzaSyAjy0k14PEvg1pxtAvhCVCDoUINXvyNaC0",

  authDomain: "neo-snake-online.firebaseapp.com",

  databaseURL: "https://neo-snake-online-default-rtdb.europe-west1.firebasedatabase.app",

  projectId: "neo-snake-online",

  storageBucket: "neo-snake-online.firebasestorage.app",

  messagingSenderId: "493503526692",

  appId: "1:493503526692:web:59e030aa42547ee74fa5b1",

  measurementId: "G-XLX20K1NQC"

};
        // =======================================

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let playerName = localStorage.getItem("snakeUser");

        const skins = {
            neon: { head: "#00d2ff", body: "rgba(58, 227, 116, ", food: "#ff4757" },
            gold: { head: "#ffcc00", body: "rgba(255, 100, 0, ", food: "#ffffff" },
            emerald: { head: "#2ecc71", body: "rgba(39, 174, 96, ", food: "#f1c40f" },
            pink: { head: "#ef57ff", body: "rgba(110, 20, 255, ", food: "#00ffcc" }
        };

        let tileCount = parseInt(localStorage.getItem("snakeSize")) || 20;
        let moveSpeed = parseFloat(localStorage.getItem("snakeSpeed")) || 0.12;
        let currentSkin = localStorage.getItem("snakeSkin") || 'neon';

        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        let score = 0, snake = [], oldSnake = [], food = {x:5,y:5}, dx=0, dy=-1, nextDx=0, nextDy=-1, moveProgress=0, isPaused=true, isCountingDown=false;

        function initGame() {
            let screenMin = Math.min(window.innerWidth * 0.95, window.innerHeight * 0.4);
            let gs = Math.floor(screenMin / tileCount);
            canvas.width = tileCount * gs; canvas.height = tileCount * gs;
            const mid = Math.floor(tileCount / 2);
            snake = [{x:mid, y:mid}, {x:mid, y:mid+1}, {x:mid, y:mid+2}];
            oldSnake = JSON.parse(JSON.stringify(snake));
            dx=0; dy=-1; nextDx=0; nextDy=-1; score=0; 
            document.getElementById("score").innerText = "0";
            createFood();
        }

        function handleInput(k) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            if (isPaused || isCountingDown) return;
            if (k === 'a' && dx !== 1) { nextDx = -1; nextDy = 0; }
            if (k === 'w' && dy !== 1) { nextDx = 0; nextDy = -1; }
            if (k === 'd' && dx !== -1) { nextDx = 1; nextDy = 0; }
            if (k === 's' && dy !== -1) { nextDx = 0; nextDy = 1; }
        }

        // –ü–û–ß–ò–ù–ö–ê –ü–ö –£–ü–†–ê–í–õ–ï–ù–ò–Ø
        window.addEventListener("keydown", e => {
            const keyMap = {
                'ArrowUp': 'w', 'ArrowDown': 's', 'ArrowLeft': 'a', 'ArrowRight': 'd',
                'w': 'w', 'a': 'a', 's': 's', 'd': 'd', 'W': 'w', 'A': 'a', 'S': 's', 'D': 'd'
            };
            if (keyMap[e.key]) {
                e.preventDefault();
                handleInput(keyMap[e.key]);
            }
        });

        function toggleSidebar() {
            const side = document.getElementById("sidebar");
            side.classList.toggle('open');
            if (side.classList.contains('open')) {
                isPaused = true;
                showOverlay('startScreen');
            }
        }

        function setSkin(s) { 
            currentSkin = s; localStorage.setItem("snakeSkin", s); 
            updateMenuButtons(); 
        }
        function setSpeed(v, id) { 
            moveSpeed = v; localStorage.setItem("snakeSpeed", v); 
            updateMenuButtons(); 
        }
        function setMapSize(v, id) { 
            tileCount = v; localStorage.setItem("snakeSize", v); 
            updateMenuButtons(); initGame(); 
        }

        function updateMenuButtons() {
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('skin_'+currentSkin)?.classList.add('active');
            document.getElementById(tileCount === 15 ? 'size_15' : 'size_20')?.classList.add('active');
            if(moveSpeed === 0.08) document.getElementById('spd_slow').classList.add('active');
            else if(moveSpeed === 0.12) document.getElementById('spd_norm').classList.add('active');
            else document.getElementById('spd_fast').classList.add('active');
        }

        function showOverlay(id) {
            document.getElementById("gameOverlay").style.display = "flex";
            ['startScreen', 'countdownText', 'deathText'].forEach(el => document.getElementById(el).style.display = "none");
            document.getElementById(id).style.display = "block";
        }

        function startCountdown() {
            isPaused = true; isCountingDown = true;
            document.getElementById("sidebar").classList.remove('open');
            showOverlay('countdownText');
            let count = 3;
            const cd = document.getElementById("countdownText");
            cd.innerText = count;
            const timer = setInterval(() => {
                count--;
                if (count > 0) cd.innerText = count;
                else {
                    clearInterval(timer);
                    document.getElementById("gameOverlay").style.display = "none";
                    isPaused = false; isCountingDown = false;
                    requestAnimationFrame(gameLoop);
                }
            }, 700);
        }

        function createFood() {
            food = { x: Math.floor(Math.random()*tileCount), y: Math.floor(Math.random()*tileCount) };
            if (snake.some(p => p.x === food.x && p.y === food.y)) createFood();
        }

        function update() {
            moveProgress += moveSpeed;
            if (moveProgress >= 1) {
                moveProgress -= 1; dx = nextDx; dy = nextDy;
                oldSnake = JSON.parse(JSON.stringify(snake));
                const head = { x: snake[0].x + dx, y: snake[0].y + dy };
                if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount ||
                    snake.some((p, i) => i !== 0 && p.x === head.x && p.y === head.y)) {
                    isPaused = true;
                    saveScore(score);
                    document.getElementById("finalScore").innerText = "–¢–í–û–ô –°–ß–ï–¢: " + score;
                    showOverlay('deathText');
                    initGame();
                    return;
                }
                snake.unshift(head);
                if (head.x === food.x && head.y === food.y) {
                    score += 10; document.getElementById("score").innerText = score;
                    createFood();
                } else { snake.pop(); }
            }
        }

        function draw() {
            let gs = canvas.width / tileCount;
            const skin = skins[currentSkin];
            ctx.fillStyle = "#000"; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = skin.food; ctx.shadowBlur = 10; ctx.shadowColor = skin.food;
            ctx.beginPath(); ctx.arc(food.x*gs+gs/2, food.y*gs+gs/2, gs/3, 0, Math.PI*2); ctx.fill();
            snake.forEach((p, i) => {
                const prev = oldSnake[i] || p;
                const x = prev.x + (p.x - prev.x) * moveProgress;
                const y = prev.y + (p.y - prev.y) * moveProgress;
                ctx.fillStyle = i === 0 ? skin.head : skin.body + (1 - i/snake.length) + ")";
                ctx.shadowBlur = i === 0 ? 15 : 0;
                ctx.beginPath(); ctx.roundRect(x*gs+1, y*gs+1, gs-2, gs-2, 4); ctx.fill();
            });
            ctx.shadowBlur = 0;
        }

        function gameLoop() { if (!isPaused) { update(); draw(); requestAnimationFrame(gameLoop); } }

        function saveScore(s) {
            if (s > 0) db.ref('leaderboard/' + playerName).once('value').then(snap => {
                if (!snap.exists() || snap.val().score < s) db.ref('leaderboard/' + playerName).set({name:playerName, score:s});
            });
        }

        db.ref('leaderboard').orderByChild('score').limitToLast(5).on('value', snap => {
            const d = []; snap.forEach(c => d.push(c.val()));
            d.sort((a,b) => b.score - a.score);
            document.getElementById("leaderboard-content").innerHTML = d.map((r,i) => 
                `<div style="display:flex; justify-content:space-between; padding:4px; border-bottom:1px solid #222;">
                <span>${i+1}. ${r.name}</span><span>${r.score}</span></div>`).join('');
        });

        function resetAccount() { if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –Ω–∏–∫?")) { localStorage.clear(); location.reload(); } }

        if(!playerName) { 
            playerName = prompt("–í–≤–µ–¥–∏ —Å–≤–æ–π –Ω–∏–∫ –¥–ª—è –æ–Ω–ª–∞–π–Ω–∞:") || "Gamer" + Math.floor(Math.random()*99);
            localStorage.setItem("snakeUser", playerName); 
        }
        
        updateMenuButtons();
        initGame();
        draw();
    </script>
</body>
</html>
