<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neo Snake Online</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body {
            display: flex; justify-content: center; align-items: center;
            height: 100vh; margin: 0; background-color: #05050a;
            color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden;
            flex-direction: column; touch-action: none;
        }
        .menu-toggle {
            position: absolute; top: 10px; left: 10px; z-index: 100;
            background: #4834d4; border: none; color: white; padding: 10px 15px; border-radius: 8px; cursor: pointer;
        }
        .sidebar {
            position: absolute; left: -280px; top: 0; width: 240px; height: 100%;
            background: rgba(10, 10, 20, 0.98); padding: 70px 20px;
            border-right: 2px solid #4834d4; transition: 0.3s; z-index: 90; overflow-y: auto;
        }
        .sidebar.open { left: 0; }
        .mode-btn { width: 100%; padding: 10px; margin-bottom: 5px; background: rgba(72, 52, 212, 0.2); border: 1px solid #4834d4; color: white; border-radius: 6px; cursor: pointer; }
        .mode-btn.active { background: #00d2ff; color: #05050a; font-weight: bold; }
        
        canvas { border: 2px solid #4834d4; border-radius: 8px; background-color: #000; max-width: 95vw; max-height: 40vh; }
        .stats { font-size: 22px; font-weight: bold; color: #00d2ff; margin-bottom: 5px; }

        /* –û–≤–µ—Ä–ª–µ–∏ (–ü–∞—É–∑–∞, –°–º–µ—Ä—Ç—å, –û—Ç—Å—á–µ—Ç) */
        #gameOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: flex; justify-content: center;
            align-items: center; z-index: 50; flex-direction: column; text-align: center;
        }
        #countdownText { font-size: 80px; color: #00d2ff; font-weight: bold; display: none; }
        #deathText { display: none; }
        #deathText h1 { color: #ff4757; margin-bottom: 10px; }
        
        .controls { display: grid; grid-template-columns: repeat(3, 70px); gap: 10px; margin-top: 15px; }
        .btn { width: 70px; height: 70px; background: rgba(72, 52, 212, 0.3); border: 2px solid #4834d4; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; color: white; }
    </style>
</head>
<body>

    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞ –ú–ï–ù–Æ</button>

    <div class="sidebar" id="sidebar">
        <h3 style="color:#00d2ff">–°–ö–ò–ù–´</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
            <button class="mode-btn active" id="skin_neon" onclick="setSkin('neon')">–ù–µ–æ–Ω</button>
            <button class="mode-btn" id="skin_gold" onclick="setSkin('gold')">–ó–æ–ª–æ—Ç–æ</button>
        </div>
        <h3 style="color:#00d2ff">–°–ö–û–†–û–°–¢–¨</h3>
        <button class="mode-btn active" id="spd_norm" onclick="setSpeed(0.12, 'spd_norm')">–û–±—ã—á–Ω—ã–π</button>
        <button class="mode-btn" id="spd_fast" onclick="setSpeed(0.18, 'spd_fast')">–ë—ã—Å—Ç—Ä–æ üî•</button>
        
        <div id="leaderboard" style="margin-top:20px; background:rgba(255,255,255,0.05); padding:10px; border-radius:8px;">
            <h4 style="text-align:center; color:#3ae374; margin:0 0 10px 0;">–¢–û–ü –ú–ò–†–ê</h4>
            <div id="leaderboard-content"></div>
        </div>
    </div>

    <div id="gameOverlay">
        <div id="startScreen">
            <h1 style="color:#00d2ff">NEO SNAKE</h1>
            <button class="mode-btn" style="width:200px; font-size:20px" onclick="startCountdown()">–ò–ì–†–ê–¢–¨</button>
        </div>
        <div id="countdownText">3</div>
        <div id="deathText">
            <h1>–¢–´ –ü–û–ì–ò–ë!</h1>
            <p id="finalScore" style="font-size:20px"></p>
            <button class="mode-btn" style="width:200px; font-size:20px" onclick="startCountdown()">–†–ï–°–¢–ê–†–¢</button>
        </div>
    </div>

    <div class="stats">SCORE: <span id="score">0</span></div>
    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <div class="btn" style="grid-column:2" ontouchstart="handleInput('w')">‚ñ≤</div>
        <div class="btn" style="grid-column:1; grid-row:2" ontouchstart="handleInput('a')">‚óÄ</div>
        <div class="btn" style="grid-column:2; grid-row:2" ontouchstart="handleInput('s')">‚ñº</div>
        <div class="btn" style="grid-column:3; grid-row:2" ontouchstart="handleInput('d')">‚ñ∂</div>
    </div>

    <script>
        // === –í–°–¢–ê–í–¨ –°–í–û–ô FIREBASE CONFIG ===
        const firebaseConfig = {

  apiKey: "AIzaSyAjy0k14PEvg1pxtAvhCVCDoUINXvyNaC0",

  authDomain: "neo-snake-online.firebaseapp.com",

  databaseURL: "https://neo-snake-online-default-rtdb.europe-west1.firebasedatabase.app",

  projectId: "neo-snake-online",

  storageBucket: "neo-snake-online.firebasestorage.app",

  messagingSenderId: "493503526692",

  appId: "1:493503526692:web:59e030aa42547ee74fa5b1",

  measurementId: "G-XLX20K1NQC"

};
        // ===================================
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let playerName = localStorage.getItem("snakeUser");

        let tileCount = 20, moveSpeed = 0.12, currentSkin = 'neon';
        const skins = { neon: {head:"#00d2ff", body:"rgba(58,227,116,", food:"#ff4757"}, gold: {head:"#ffcc00", body:"rgba(255,100,0,", food:"#fff"}};

        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        let score = 0, snake = [], oldSnake = [], food = {x:5,y:5}, dx=0, dy=-1, nextDx=0, nextDy=-1, moveProgress=0, isPaused=true, isCountingDown=false;

        function initGame() {
            let screenMin = Math.min(window.innerWidth * 0.95, window.innerHeight * 0.4);
            let gridSize = Math.floor(screenMin / tileCount);
            canvas.width = tileCount * gridSize; canvas.height = tileCount * gridSize;
            const mid = Math.floor(tileCount / 2);
            snake = [{x:mid, y:mid}, {x:mid, y:mid+1}, {x:mid, y:mid+2}];
            oldSnake = JSON.parse(JSON.stringify(snake));
            dx=0; dy=-1; nextDx=0; nextDy=-1; score=0; 
            document.getElementById("score").innerText = "0";
            createFood();
        }

        function handleInput(k) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            if (isPaused || isCountingDown) return;
            if (k === 'a' && dx !== 1) { nextDx = -1; nextDy = 0; }
            if (k === 'w' && dy !== 1) { nextDx = 0; nextDy = -1; }
            if (k === 'd' && dx !== -1) { nextDx = 1; nextDy = 0; }
            if (k === 's' && dy !== -1) { nextDx = 0; nextDy = 1; }
        }

        function toggleSidebar() {
            const side = document.getElementById("sidebar");
            side.classList.toggle('open');
            if (side.classList.contains('open')) {
                isPaused = true;
                showOverlay('startScreen');
            }
        }

        function showOverlay(id) {
            document.getElementById("gameOverlay").style.display = "flex";
            ['startScreen', 'countdownText', 'deathText'].forEach(el => document.getElementById(el).style.display = "none");
            document.getElementById(id).style.display = "block";
        }

        function startCountdown() {
            isPaused = true;
            isCountingDown = true;
            document.getElementById("sidebar").classList.remove('open');
            showOverlay('countdownText');
            let count = 3;
            const cd = document.getElementById("countdownText");
            cd.innerText = count;
            
            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    cd.innerText = count;
                } else {
                    clearInterval(timer);
                    document.getElementById("gameOverlay").style.display = "none";
                    isPaused = false;
                    isCountingDown = false;
                    requestAnimationFrame(gameLoop);
                }
            }, 800);
        }

        function onDeath() {
            isPaused = true;
            saveScore(score);
            document.getElementById("finalScore").innerText = "–¢–≤–æ–π —Å—á–µ—Ç: " + score;
            showOverlay('deathText');
            initGame();
        }

        function createFood() {
            food = { x: Math.floor(Math.random()*tileCount), y: Math.floor(Math.random()*tileCount) };
            if (snake.some(p => p.x === food.x && p.y === food.y)) createFood();
        }

        function update() {
            moveProgress += moveSpeed;
            if (moveProgress >= 1) {
                moveProgress -= 1; dx = nextDx; dy = nextDy;
                oldSnake = JSON.parse(JSON.stringify(snake));
                const head = { x: snake[0].x + dx, y: snake[0].y + dy };
                if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount ||
                    snake.some((p, i) => i !== 0 && p.x === head.x && p.y === head.y)) {
                    onDeath(); return;
                }
                snake.unshift(head);
                if (head.x === food.x && head.y === food.y) {
                    score += 10; document.getElementById("score").innerText = score;
                    createFood();
                } else { snake.pop(); }
            }
        }

        function draw() {
            let gs = canvas.width / tileCount;
            const skin = skins[currentSkin];
            ctx.fillStyle = "#000"; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = skin.food; ctx.beginPath(); ctx.arc(food.x*gs+gs/2, food.y*gs+gs/2, gs/3, 0, Math.PI*2); ctx.fill();
            snake.forEach((p, i) => {
                const prev = oldSnake[i] || p;
                const x = prev.x + (p.x - prev.x) * moveProgress;
                const y = prev.y + (p.y - prev.y) * moveProgress;
                ctx.fillStyle = i === 0 ? skin.head : skin.body + (1 - i/snake.length) + ")";
                ctx.beginPath(); ctx.roundRect(x*gs+1, y*gs+1, gs-2, gs-2, 4); ctx.fill();
            });
        }

        function gameLoop() { if (!isPaused) { update(); draw(); requestAnimationFrame(gameLoop); } }

        function saveScore(s) {
            if (s > 0) db.ref('leaderboard/' + playerName).once('value').then(snap => {
                if (!snap.exists() || snap.val().score < s) db.ref('leaderboard/' + playerName).set({name:playerName, score:s});
            });
        }

        db.ref('leaderboard').orderByChild('score').limitToLast(5).on('value', snap => {
            const d = []; snap.forEach(c => d.push(c.val()));
            d.sort((a,b) => b.score - a.score);
            document.getElementById("leaderboard-content").innerHTML = d.map((r,i) => `<div style="display:flex; justify-content:space-between; font-size:12px; border-bottom:1px solid #222; padding:3px;"><span>${i+1}. ${r.name}</span><span>${r.score}</span></div>`).join('');
        });

        if(!playerName) { playerName = prompt("–ù–∏–∫:") || "Gamer"; localStorage.setItem("snakeUser", playerName); }
        initGame(); draw();
    </script>
</body>
</html>
