<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Online: Skins & Settings</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body {
            display: flex; justify-content: center; align-items: center;
            height: 100vh; margin: 0; background-color: #05050a;
            color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden;
            flex-direction: column; touch-action: none;
        }
        .menu-toggle {
            position: absolute; top: 10px; left: 10px; z-index: 100;
            background: #4834d4; border: none; color: white; padding: 10px 15px; border-radius: 8px; cursor: pointer;
        }
        .sidebar {
            position: absolute; left: -280px; top: 0; width: 240px; height: 100%;
            background: rgba(10, 10, 20, 0.98); padding: 60px 20px;
            border-right: 2px solid #4834d4; transition: 0.3s; z-index: 90; overflow-y: auto;
        }
        .sidebar.open { left: 0; }
        .section-title { color: #00d2ff; font-size: 14px; margin: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px; }
        .mode-btn { width: 100%; padding: 10px; margin-bottom: 5px; background: rgba(72, 52, 212, 0.2); border: 1px solid #4834d4; color: white; border-radius: 6px; cursor: pointer; font-size: 13px; }
        .mode-btn.active { background: #00d2ff; color: #05050a; font-weight: bold; border-color: #fff; }
        
        .skin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        
        canvas { border: 2px solid #4834d4; border-radius: 8px; background-color: #000; max-width: 95vw; max-height: 40vh; }
        .stats { font-size: 22px; font-weight: bold; color: #00d2ff; margin-bottom: 5px; }
        
        .leaderboard { background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 8px; margin-top: 10px; }
        .entry { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 4px 0; font-size: 12px; }

        .controls { display: grid; grid-template-columns: repeat(3, 70px); gap: 10px; margin-top: 15px; }
        .btn { width: 70px; height: 70px; background: rgba(72, 52, 212, 0.3); border: 2px solid #4834d4; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; color: white; }
        
        #pauseOverlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 50; flex-direction: column; }
    </style>
</head>
<body>

    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞ –ú–ï–ù–Æ</button>

    <div class="sidebar" id="sidebar">
        <div class="section-title">–°–∫–∏–Ω –∑–º–µ–π–∫–∏</div>
        <div class="skin-grid">
            <button class="mode-btn active" id="skin_neon" onclick="setSkin('neon')">–ù–µ–æ–Ω</button>
            <button class="mode-btn" id="skin_gold" onclick="setSkin('gold')">–ó–æ–ª–æ—Ç–æ</button>
            <button class="mode-btn" id="skin_emerald" onclick="setSkin('emerald')">–ò–∑—É–º—Ä—É–¥</button>
            <button class="mode-btn" id="skin_pink" onclick="setSkin('pink')">–§–∞–Ω—Ç–æ–º</button>
        </div>

        <div class="section-title">–°–∫–æ—Ä–æ—Å—Ç—å</div>
        <button class="mode-btn" id="spd_slow" onclick="setSpeed(0.08, 'spd_slow')">–ú–µ–¥–ª–µ–Ω–Ω–æ</button>
        <button class="mode-btn active" id="spd_norm" onclick="setSpeed(0.12, 'spd_norm')">–û–±—ã—á–Ω—ã–π</button>
        <button class="mode-btn" id="spd_fast" onclick="setSpeed(0.18, 'spd_fast')">–ë—ã—Å—Ç—Ä–æ üî•</button>

        <div class="section-title">–†–∞–∑–º–µ—Ä –∫–∞—Ä—Ç—ã</div>
        <button class="mode-btn" id="size_15" onclick="setMapSize(15, 'size_15')">–ú–∞–ª–∞—è (15x15)</button>
        <button class="mode-btn active" id="size_20" onclick="setMapSize(20, 'size_20')">–°—Ç–∞–Ω–¥–∞—Ä—Ç (20x20)</button>

        <div class="leaderboard">
            <h4 style="margin:0; text-align:center; color:#3ae374">–¢–û–ü –û–ù–õ–ê–ô–ù</h4>
            <div id="leaderboard-content"></div>
        </div>
        <button class="mode-btn" style="margin-top:20px; opacity:0.5" onclick="resetAccount()">–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</button>
    </div>

    <div id="pauseOverlay">
        <h1 style="color:#00d2ff">NEO SNAKE</h1>
        <button class="mode-btn" style="width:180px; font-size:18px" onclick="togglePause()">–ò–ì–†–ê–¢–¨</button>
    </div>

    <div class="stats">–°–ß–ï–¢: <span id="score">0</span></div>
    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <div class="btn" style="grid-column:2" ontouchstart="handleInput('w')" onmousedown="handleInput('w')">‚ñ≤</div>
        <div class="btn" style="grid-column:1; grid-row:2" ontouchstart="handleInput('a')" onmousedown="handleInput('a')">‚óÄ</div>
        <div class="btn" style="grid-column:2; grid-row:2" ontouchstart="handleInput('s')" onmousedown="handleInput('s')">‚ñº</div>
        <div class="btn" style="grid-column:3; grid-row:2" ontouchstart="handleInput('d')" onmousedown="handleInput('d')">‚ñ∂</div>
    </div>

    <script>
        // === FIREBASE CONFIG ===
        const firebaseConfig = {

  apiKey: "AIzaSyAjy0k14PEvg1pxtAvhCVCDoUINXvyNaC0",

  authDomain: "neo-snake-online.firebaseapp.com",

  databaseURL: "https://neo-snake-online-default-rtdb.europe-west1.firebasedatabase.app",

  projectId: "neo-snake-online",

  storageBucket: "neo-snake-online.firebasestorage.app",

  messagingSenderId: "493503526692",

  appId: "1:493503526692:web:59e030aa42547ee74fa5b1",

  measurementId: "G-XLX20K1NQC"

};
        // =======================

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let playerName = localStorage.getItem("snakeUser");
        
        // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ---
        let tileCount = 20;
        let moveSpeed = 0.12;
        let currentSkin = localStorage.getItem("snakeSkin") || 'neon';
        
        const skins = {
            neon: { head: "#00d2ff", body: "rgba(58, 227, 116, ", food: "#ff4757" },
            gold: { head: "#ffcc00", body: "rgba(255, 100, 0, ", food: "#ffffff" },
            emerald: { head: "#2ecc71", body: "rgba(39, 174, 96, ", food: "#f1c40f" },
            pink: { head: "#ef57ff", body: "rgba(110, 20, 255, ", food: "#00ffcc" }
        };

        function setSkin(type) {
            currentSkin = type;
            localStorage.setItem("snakeSkin", type);
            document.querySelectorAll('[id^="skin_"]').forEach(b => b.classList.remove('active'));
            document.getElementById('skin_'+type).classList.add('active');
        }

        function setSpeed(val, id) {
            moveSpeed = val;
            document.querySelectorAll('[id^="spd_"]').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function setMapSize(val, id) {
            tileCount = val;
            document.querySelectorAll('[id^="size_"]').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            initGame();
        }

        function toggleSidebar() { document.getElementById("sidebar").classList.toggle('open'); }

        // --- –õ–û–ì–ò–ö–ê ---
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(f, d, v) {
            try {
                const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
                o.frequency.setValueAtTime(f, audioCtx.currentTime);
                g.gain.setValueAtTime(v, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
                o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + d);
            } catch(e){}
        }

        let gridSize, score = 0, snake = [], oldSnake = [], food = {x: 5, y: 5}, dx = 0, dy = -1, nextDx = 0, nextDy = -1, moveProgress = 0, isPaused = true;

        function initGame() {
            let screenMin = Math.min(window.innerWidth * 0.95, window.innerHeight * 0.4);
            gridSize = Math.floor(screenMin / tileCount);
            canvas.width = tileCount * gridSize; canvas.height = tileCount * gridSize;
            const mid = Math.floor(tileCount / 2);
            snake = [{x: mid, y: mid}, {x: mid, y: mid+1}, {x: mid, y: mid+2}];
            oldSnake = JSON.parse(JSON.stringify(snake));
            dx = 0; dy = -1; nextDx = 0; nextDy = -1;
            score = 0; document.getElementById("score").innerText = "0";
            createFood();
        }

        function handleInput(k) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            if (isPaused) return;
            if (k === 'a' && dx !== 1) { nextDx = -1; nextDy = 0; playSound(200, 0.05, 0.05); }
            if (k === 'w' && dy !== 1) { nextDx = 0; nextDy = -1; playSound(200, 0.05, 0.05); }
            if (k === 'd' && dx !== -1) { nextDx = 1; nextDy = 0; playSound(200, 0.05, 0.05); }
            if (k === 's' && dy !== -1) { nextDx = 0; nextDy = 1; playSound(200, 0.05, 0.05); }
        }

        function togglePause() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isPaused = !isPaused;
            document.getElementById("pauseOverlay").style.display = isPaused ? "flex" : "none";
            document.getElementById("sidebar").classList.remove('open');
            if (!isPaused) requestAnimationFrame(gameLoop);
        }

        function createFood() {
            food = { x: Math.floor(Math.random()*tileCount), y: Math.floor(Math.random()*tileCount) };
            if (snake.some(p => p.x === food.x && p.y === food.y)) createFood();
        }

        function update() {
            moveProgress += moveSpeed;
            if (moveProgress >= 1) {
                moveProgress -= 1; dx = nextDx; dy = nextDy;
                oldSnake = JSON.parse(JSON.stringify(snake));
                const head = { x: snake[0].x + dx, y: snake[0].y + dy };
                if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount ||
                    snake.some((p, i) => i !== 0 && p.x === head.x && p.y === head.y)) {
                    playSound(100, 0.4, 0.2);
                    saveScore(score);
                    alert("–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê! –°—á–µ—Ç: " + score);
                    initGame(); return;
                }
                snake.unshift(head);
                if (head.x === food.x && head.y === food.y) {
                    score += 10; document.getElementById("score").innerText = score;
                    playSound(600, 0.1, 0.1); createFood();
                } else { snake.pop(); }
            }
        }

        function draw() {
            const skin = skins[currentSkin];
            ctx.fillStyle = "#000"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ï–¥–∞
            ctx.fillStyle = skin.food; ctx.shadowBlur = 15; ctx.shadowColor = skin.food;
            ctx.beginPath(); ctx.arc(food.x*gridSize+gridSize/2, food.y*gridSize+gridSize/2, gridSize/3, 0, Math.PI*2); ctx.fill();
            
            // –ó–º–µ–π–∫–∞
            snake.forEach((part, i) => {
                const prev = oldSnake[i] || part;
                const x = prev.x + (part.x - prev.x) * moveProgress;
                const y = prev.y + (part.y - prev.y) * moveProgress;
                ctx.fillStyle = i === 0 ? skin.head : skin.body + (1 - i/snake.length) + ")";
                ctx.shadowBlur = i === 0 ? 15 : 0;
                ctx.beginPath(); ctx.roundRect(x*gridSize+1, y*gridSize+1, gridSize-2, gridSize-2, 4); ctx.fill();
            });
            ctx.shadowBlur = 0;
        }

        function gameLoop() { if (!isPaused) { update(); draw(); requestAnimationFrame(gameLoop); } }

        // --- –û–ù–õ–ê–ô–ù –ß–ê–°–¢–¨ ---
        function saveScore(s) {
            if (s <= 0) return;
            db.ref('leaderboard/' + playerName).once('value').then(snap => {
                if (!snap.exists() || snap.val().score < s) db.ref('leaderboard/' + playerName).set({name: playerName, score: s});
            });
        }

        db.ref('leaderboard').orderByChild('score').limitToLast(5).on('value', snap => {
            const data = []; snap.forEach(c => data.push(c.val()));
            data.sort((a,b) => b.score - a.score);
            document.getElementById("leaderboard-content").innerHTML = data.map((r, i) => 
                `<div class="entry"><span>${i+1}. ${r.name}</span><span>${r.score}</span></div>`).join('');
        });

        function checkAccount() {
            if (!playerName) {
                playerName = prompt("–ù–∏–∫ –¥–ª—è –æ–Ω–ª–∞–π–Ω–∞:", "–ò–≥—Ä–æ–∫") || "Gamer" + Math.floor(Math.random()*99);
                localStorage.setItem("snakeUser", playerName);
            }
            setSkin(currentSkin);
            initGame();
        }
        
        function resetAccount() { if(confirm("–°–±—Ä–æ—Å–∏—Ç—å?")) { localStorage.clear(); location.reload(); } }

        window.addEventListener("keydown", e => {
            const m = {arrowup:'w',arrowdown:'s',arrowleft:'a',arrowright:'d',w:'w',a:'a',s:'s',d:'d'};
            if(m[e.key.toLowerCase()]) handleInput(m[e.key.toLowerCase()]);
        });

        checkAccount();
    </script>
</body>
</html>
