<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Online Battle</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body {
            display: flex; justify-content: center; align-items: center;
            height: 100vh; margin: 0; background-color: #05050a;
            color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden;
            flex-direction: column; touch-action: none;
        }
        .menu-toggle {
            position: absolute; top: 10px; left: 10px; z-index: 100;
            background: #4834d4; border: none; color: white; padding: 10px 15px; border-radius: 8px; cursor: pointer;
            box-shadow: 0 0 10px #4834d4;
        }
        .sidebar {
            position: absolute; left: -280px; top: 0; width: 240px; height: 100%;
            background: rgba(10, 10, 20, 0.98); padding: 70px 20px;
            border-right: 2px solid #4834d4; transition: 0.3s; z-index: 90;
        }
        .sidebar.open { left: 0; }
        .user-info { margin-bottom: 15px; padding: 10px; background: rgba(0, 210, 255, 0.1); border-radius: 8px; border: 1px solid #00d2ff; text-align: center; }
        .mode-btn { width: 100%; padding: 12px; margin-bottom: 10px; background: rgba(72, 52, 212, 0.2); border: 1px solid #4834d4; color: white; border-radius: 6px; cursor: pointer; }
        .mode-btn.active { background: #00d2ff; color: #05050a; font-weight: bold; }
        canvas { border: 2px solid #4834d4; border-radius: 8px; background-color: #000; max-width: 95vw; max-height: 45vh; box-shadow: 0 0 30px rgba(72, 52, 212, 0.3); }
        .stats { font-size: 24px; font-weight: bold; color: #00d2ff; margin-bottom: 10px; text-shadow: 0 0 10px #00d2ff; }
        .leaderboard { background: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 8px; margin-top: 15px; }
        .leaderboard h4 { margin: 0 0 10px 0; color: #3ae374; text-align: center; text-transform: uppercase; letter-spacing: 1px; }
        .entry { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 6px 0; font-size: 14px; }
        .controls { display: grid; grid-template-columns: repeat(3, 75px); gap: 12px; margin-top: 20px; }
        .btn { width: 75px; height: 75px; background: rgba(72, 52, 212, 0.3); border: 2px solid #4834d4; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; color: white; -webkit-tap-highlight-color: transparent; }
        .btn:active { background: #00d2ff; transform: scale(0.9); }
        #pauseOverlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 50; flex-direction: column; text-align: center; }
    </style>
</head>
<body>

    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞ –ú–ï–ù–Æ</button>

    <div class="sidebar" id="sidebar">
        <div class="user-info">–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å: <br><b id="player-name">...</b></div>
        <div class="leaderboard">
            <h4>–¢–û–ü-5 –û–ù–õ–ê–ô–ù üî•</h4>
            <div id="leaderboard-content">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        <button class="mode-btn" style="margin-top:30px; font-size:11px; opacity:0.6" onclick="resetAccount()">–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</button>
    </div>

    <div id="pauseOverlay">
        <h1 style="color:#00d2ff; margin-bottom: 5px;">SNAKE ONLINE</h1>
        <p style="color:#aaa; margin-bottom: 25px;">–°–æ–±–µ—Ä–∏ –±–æ–ª—å—à–µ –≤—Å–µ—Ö!</p>
        <button class="mode-btn" style="width:200px; font-size: 18px;" onclick="toggleMenu()">–ò–ì–†–ê–¢–¨</button>
    </div>

    <div class="stats">–°–ß–ï–¢: <span id="score">0</span></div>
    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <div class="btn" style="grid-column:2" ontouchstart="handleInput('w')" onmousedown="handleInput('w')">‚ñ≤</div>
        <div class="btn" style="grid-column:1; grid-row:2" ontouchstart="handleInput('a')" onmousedown="handleInput('a')">‚óÄ</div>
        <div class="btn" style="grid-column:2; grid-row:2" ontouchstart="handleInput('s')" onmousedown="handleInput('s')">‚ñº</div>
        <div class="btn" style="grid-column:3; grid-row:2" ontouchstart="handleInput('d')" onmousedown="handleInput('d')">‚ñ∂</div>
    </div>

    <script>
        // === –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï –ò–ó FIREBASE –ó–î–ï–°–¨ ===
        const firebaseConfig = {

  apiKey: "AIzaSyAjy0k14PEvg1pxtAvhCVCDoUINXvyNaC0",

  authDomain: "neo-snake-online.firebaseapp.com",

  databaseURL: "https://neo-snake-online-default-rtdb.europe-west1.firebasedatabase.app",

  projectId: "neo-snake-online",

  storageBucket: "neo-snake-online.firebasestorage.app",

  messagingSenderId: "493503526692",

  appId: "1:493503526692:web:59e030aa42547ee74fa5b1",

  measurementId: "G-XLX20K1NQC"

};
        // ===========================================

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let playerName = localStorage.getItem("snakeUser");
        
        function checkAccount() {
            if (!playerName) {
                let name = prompt("–í–≤–µ–¥–∏ —Å–≤–æ–π –Ω–∏–∫ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–±–∏—Ç–≤—ã:", "");
                if (!name || name.trim() === "") name = "Gamer_" + Math.floor(Math.random()*999);
                playerName = name.slice(0, 12);
                localStorage.setItem("snakeUser", playerName);
            }
            document.getElementById("player-name").innerText = playerName;
        }

        // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤
        db.ref('leaderboard').orderByChild('score').limitToLast(5).on('value', (snapshot) => {
            const data = [];
            snapshot.forEach(child => { data.push(child.val()); });
            data.sort((a,b) => b.score - a.score);
            
            const container = document.getElementById("leaderboard-content");
            container.innerHTML = data.length > 0 ? data.map((res, i) => 
                `<div class="entry"><span>${i+1}. ${res.name}</span><span>${res.score}</span></div>`
            ).join('') : "–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤";
        });

        function saveScoreOnline(s) {
            if (s <= 0) return;
            db.ref('leaderboard/' + playerName).once('value').then((snap) => {
                if (!snap.exists() || snap.val().score < s) {
                    db.ref('leaderboard/' + playerName).set({ name: playerName, score: s });
                }
            });
        }

        function resetAccount() { if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –Ω–∏–∫?")) { localStorage.clear(); location.reload(); } }

        // --- –ì–ï–ô–ú–ü–õ–ï–ô ---
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(f, d, v) {
            try {
                const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
                o.frequency.setValueAtTime(f, audioCtx.currentTime);
                g.gain.setValueAtTime(v, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
                o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + d);
            } catch(e){}
        }

        let gridSize = 20, tileCount = 20, score = 0, snake = [], oldSnake = [], food = {x: 5, y: 5}, dx = 0, dy = -1, nextDx = 0, nextDy = -1, moveProgress = 0, moveSpeed = 0.12, isPaused = true;

        function initGame() {
            let screenMin = Math.min(window.innerWidth * 0.95, window.innerHeight * 0.45);
            gridSize = Math.floor(screenMin / tileCount);
            canvas.width = tileCount * gridSize; canvas.height = tileCount * gridSize;
            const mid = Math.floor(tileCount / 2);
            snake = [{x: mid, y: mid}, {x: mid, y: mid+1}, {x: mid, y: mid+2}];
            oldSnake = JSON.parse(JSON.stringify(snake));
            dx = 0; dy = -1; nextDx = 0; nextDy = -1;
            score = 0; document.getElementById("score").innerText = "0";
            createFood();
        }

        function handleInput(k) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            if (isPaused) return;
            if (k === 'a' && dx !== 1) { nextDx = -1; nextDy = 0; playSound(200, 0.1, 0.05); }
            if (k === 'w' && dy !== 1) { nextDx = 0; nextDy = -1; playSound(200, 0.1, 0.05); }
            if (k === 'd' && dx !== -1) { nextDx = 1; nextDy = 0; playSound(200, 0.1, 0.05); }
            if (k === 's' && dy !== -1) { nextDx = 0; nextDy = 1; playSound(200, 0.1, 0.05); }
        }

        function toggleMenu() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isPaused = !isPaused;
            document.getElementById("sidebar").classList.remove('open');
            document.getElementById("pauseOverlay").style.display = isPaused ? "flex" : "none";
            if (!isPaused) requestAnimationFrame(gameLoop);
            playSound(400, 0.1, 0.1);
        }

        function createFood() {
            food = { x: Math.floor(Math.random()*tileCount), y: Math.floor(Math.random()*tileCount) };
            if (snake.some(p => p.x === food.x && p.y === food.y)) createFood();
        }

        function update() {
            moveProgress += moveSpeed;
            if (moveProgress >= 1) {
                moveProgress -= 1; dx = nextDx; dy = nextDy;
                oldSnake = JSON.parse(JSON.stringify(snake));
                const head = { x: snake[0].x + dx, y: snake[0].y + dy };
                if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount ||
                    snake.some((p, i) => i !== 0 && p.x === head.x && p.y === head.y)) {
                    playSound(100, 0.5, 0.2);
                    saveScoreOnline(score);
                    alert("GAME OVER! –°—á–µ—Ç: " + score);
                    initGame(); return;
                }
                snake.unshift(head);
                if (head.x === food.x && head.y === food.y) {
                    score += 10; document.getElementById("score").innerText = score;
                    playSound(600, 0.2, 0.1); createFood();
                } else { snake.pop(); }
            }
        }

        function draw() {
            ctx.fillStyle = "#000"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#ff4757"; ctx.shadowBlur = 15; ctx.shadowColor = "#ff4757";
            ctx.beginPath(); ctx.arc(food.x*gridSize+gridSize/2, food.y*gridSize+gridSize/2, gridSize/3, 0, Math.PI*2); ctx.fill();
            snake.forEach((part, i) => {
                const prev = oldSnake[i] || part;
                const x = prev.x + (part.x - prev.x) * moveProgress;
                const y = prev.y + (part.y - prev.y) * moveProgress;
                ctx.fillStyle = i === 0 ? "#00d2ff" : `rgba(58, 227, 116, ${1 - i/snake.length})`;
                ctx.shadowBlur = i === 0 ? 15 : 0;
                ctx.beginPath(); ctx.roundRect(x*gridSize+1, y*gridSize+1, gridSize-2, gridSize-2, 5); ctx.fill();
            });
            ctx.shadowBlur = 0;
        }

        function gameLoop() { if (!isPaused) { update(); draw(); requestAnimationFrame(gameLoop); } }
        
        window.addEventListener("keydown", e => {
            const keys = {'arrowup':'w','arrowdown':'s','arrowleft':'a','arrowright':'d','w':'w','a':'a','s':'s','d':'d'};
            if(keys[e.key.toLowerCase()]) handleInput(keys[e.key.toLowerCase()]);
        });
        
        document.querySelector('.menu-toggle').onclick = () => {
            document.getElementById("sidebar").classList.toggle('open');
        };

        checkAccount(); initGame(); requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
